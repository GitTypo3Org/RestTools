%
% typo3.sty
%
% Adapted from sphinx.sty, written by Xavier Perseguers.
%

\NeedsTeXFormat{LaTeX2e}[1995/12/01]
\ProvidesPackage{typo3}[2013/07/02 LaTeX package (TYPO3 branding)]

% Microtypography to disable ligatures
\RequirePackage{microtype}

% TYPO3 font and logo
\newcommand{\sharefont}{\fontfamily{typo3share}\selectfont}
\newcommand{\typothreelogo}{\includegraphics[height=.4cm]{typo3_logo_color}}

% Share font family does not support ligatures
\DisableLigatures{encoding = *, family = typo3share}

% --------------------------------------------
% Override configuration from sphinx.sty
% --------------------------------------------

\renewcommand{\py@HeaderFamily}{\sharefont\bfseries}

% Redefine the 'normal' header/footer style when using "fancyhdr" package:
\@ifundefined{fancyhf}{}{
  % Use \pagestyle{normal} as the primary pagestyle for text.
  \fancypagestyle{normal}{
    \fancyhf{}
    \fancyfoot[LE,RO]{{\py@HeaderFamily\thepage}}
    \fancyfoot[LO]{{\py@HeaderFamily\nouppercase{\rightmark}}}
    \fancyfoot[RE]{{%
		\sharefont inspiring people to \textbf{\emph{share}}.%
		\quad%
		\typothreelogo%
	}}
	\fancyhead[LE]{{\py@HeaderFamily \@title, \py@release}}
	\fancyhead[RO]{{\py@HeaderFamily\nouppercase{\leftmark}}}
    \renewcommand{\headrulewidth}{0.4pt}
    \renewcommand{\footrulewidth}{0.4pt}
    % define chaptermark with \@chappos when \@chappos is available for Japanese
    \ifx\@chappos\undefined\else
      \def\chaptermark##1{\markboth{\@chapapp\space\thechapter\space\@chappos\space ##1}{}}
    \fi
  }
  % Update the plain style so we get the page number & footer line,
  % but not a chapter or section title.  This is to keep the first
  % page of a chapter and the blank page between chapters `clean.'
  \fancypagestyle{plain}{
    \fancyhf{}
    \fancyfoot[LE,RO]{{\py@HeaderFamily\thepage}}
    \renewcommand{\headrulewidth}{0pt}
    \renewcommand{\footrulewidth}{0.4pt}
  }
}